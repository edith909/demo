-- ============================================
-- EXPERIMENT 9:
-- PL/SQL Programs demonstrating all types of Cursors
-- ============================================

SET SERVEROUTPUT ON;

-- ============================================
-- CREATE SAMPLE TABLE
-- ============================================

CREATE TABLE EMP (
    EMP_ID      NUMBER PRIMARY KEY,
    EMP_NAME    VARCHAR2(50),
    DEPT        VARCHAR2(50),
    SALARY      NUMBER(10,2)
);

-- INSERT SAMPLE DATA
INSERT INTO EMP VALUES (101, 'Rohan',  'IT',        45000);
INSERT INTO EMP VALUES (102, 'Sneha',  'HR',        35000);
INSERT INTO EMP VALUES (103, 'Amit',   'IT',        50000);
INSERT INTO EMP VALUES (104, 'Priya',  'Finance',   38000);
INSERT INTO EMP VALUES (105, 'Kiran',  'HR',        42000);

COMMIT;

-- ============================================
-- 1. IMPLICIT CURSOR 
-- (used automatically for INSERT/UPDATE/DELETE)
-- ============================================

BEGIN
    UPDATE EMP
    SET SALARY = SALARY + 1000
    WHERE DEPT = 'IT';

    DBMS_OUTPUT.PUT_LINE('Rows Updated = ' || SQL%ROWCOUNT);
END;
/
-- SQL%ROWCOUNT, SQL%FOUND, SQL%NOTFOUND, SQL%ISOPEN


-- ============================================
-- 2. EXPLICIT CURSOR
-- ============================================

DECLARE
    CURSOR emp_cur IS
        SELECT EMP_ID, EMP_NAME, SALARY FROM EMP;

    v_id     EMP.EMP_ID%TYPE;
    v_name   EMP.EMP_NAME%TYPE;
    v_sal    EMP.SALARY%TYPE;
BEGIN
    OPEN emp_cur;

    LOOP
        FETCH emp_cur INTO v_id, v_name, v_sal;
        EXIT WHEN emp_cur%NOTFOUND;

        DBMS_OUTPUT.PUT_LINE(
            'ID: ' || v_id || '  Name: ' || v_name ||
            '  Salary: ' || v_sal
        );
    END LOOP;

    CLOSE emp_cur;
END;
/
-- This shows manual OPEN, FETCH, CLOSE


-- ============================================
-- 3. CURSOR FOR LOOP
-- (NO FETCH, NO OPEN, NO CLOSE)
-- ============================================

DECLARE
    CURSOR c1 IS
        SELECT EMP_NAME, DEPT FROM EMP;
BEGIN
    FOR rec IN c1 LOOP
        DBMS_OUTPUT.PUT_LINE(
            'Employee: ' || rec.EMP_NAME ||
            ' | Dept: ' || rec.DEPT
        );
    END LOOP;
END;
/
-- Cursor FOR loop automatically opens/closes cursor


-- ============================================
-- 4. CURSOR WITH PARAMETERS
-- ============================================

DECLARE
    CURSOR dept_cur(p_dept VARCHAR2) IS
        SELECT EMP_NAME, SALARY
        FROM EMP
        WHERE DEPT = p_dept;

BEGIN
    DBMS_OUTPUT.PUT_LINE('--- HR Department Employees ---');
    FOR rec IN dept_cur('HR') LOOP
        DBMS_OUTPUT.PUT_LINE(rec.EMP_NAME || ' earns ' || rec.SALARY);
    END LOOP;

    DBMS_OUTPUT.PUT_LINE('--- IT Department Employees ---');
    FOR rec IN dept_cur('IT') LOOP
        DBMS_OUTPUT.PUT_LINE(rec.EMP_NAME || ' earns ' || rec.SALARY);
    END LOOP;
END;
/
-- Cursor with runtime parameters


-- ============================================
-- 5. CURSOR FOR UPDATE with WHERE CURRENT OF
-- (Used to update row currently fetched by cursor)
-- ============================================

DECLARE
    CURSOR c_sal IS
        SELECT EMP_ID, SALARY
        FROM EMP
        FOR UPDATE;   -- locks rows for update

BEGIN
    FOR emp_rec IN c_sal LOOP
        UPDATE EMP
        SET SALARY = emp_rec.SALARY + 500   -- increment
        WHERE CURRENT OF c_sal;              -- update exact row

        DBMS_OUTPUT.PUT_LINE(
            'Updated Employee ID ' || emp_rec.EMP_ID
        );
    END LOOP;
END;
/

-- Check updated values
SELECT * FROM EMP;

-- ============================================
-- END OF CURSOR EXPERIMENT
-- ============================================
